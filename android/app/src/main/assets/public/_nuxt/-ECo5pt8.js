import{ab as v,r as c,i as h}from"./S-9llA6t.js";const y=v("auth",()=>{const a=c(null),t=c(null);{const e=localStorage.getItem("token"),o=localStorage.getItem("user");if(e&&(a.value=e),o)try{const r=JSON.parse(o);r&&typeof r=="object"&&(t.value=r,t.value&&(localStorage.setItem("userName",t.value.name),localStorage.setItem("userRole",t.value.role)))}catch(r){console.error("Error parsing saved user:",r),t.value=null}}const l=e=>{a.value=e,localStorage.setItem("token",e)},n=e=>{const o={_id:e._id,name:e.name,email:e.email,avatar:e.avatar,role:e.role,position:e.position,department:e.department,education:e.education,researchWorks:e.researchWorks};t.value=o,localStorage.setItem("user",JSON.stringify(o)),localStorage.setItem("userName",o.name),localStorage.setItem("userRole",o.role)},i=async e=>{try{const o=await fetch("/api/profile/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.value}`},body:JSON.stringify(e)});if(!o.ok){const s=await o.json();throw new Error(s.message||"Failed to update profile")}const r=await o.json();n(r.user)}catch(o){throw console.error("Profile update error:",o),o}},u=e=>{if(!e)return!1;const o=e.split(".");if(o.length!==3)return!1;try{const r=JSON.parse(atob(o[1])),s=Math.floor(Date.now()/1e3);return r.exp>s}catch(r){return console.error("Token validation error:",r),!1}},m=async(e,o)=>{try{const r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:o})});if(!r.ok){const g=await r.json();throw new Error(g.message||"Login failed")}const s=await r.json();l(s.token),n(s.user)}catch(r){throw console.error("Login error:",r),r}},p=()=>{a.value=null,t.value=null,localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("userName"),localStorage.removeItem("userRole")},d=()=>a.value?u(a.value):!1,f=h(()=>t.value);return{token:a,user:t,setToken:l,setUser:n,updateProfile:i,login:m,logout:p,isAuthenticated:d,authUser:f}});export{y as u};
